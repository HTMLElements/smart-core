
/* Smart HTML Elements v1.0.0 (2018-April) 
Copyright (c) 2011-2018 jQWidgets. 
License: http://htmlelements.com/pricing/ */

 "use strict";Smart("smart-calendar",function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"template",value:function(){return'<div id="container">\n                    <div id="title" class="smart-calendar-title">\n                        <div id="yearContainer" class="smart-year-container"></div>\n                        <div id="dateContainer" class="smart-date-container smart-selected"></div>\n                    </div>\n                    <div id="calendarContainer" class="smart-calendar-container">\n                        <div id="header" class ="smart-header">\n                            <smart-repeat-button class="smart-previous-month-button" id="previousMonthButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">\n                                <div class ="smart-arrow">&#xe809</div>\n                            </smart-repeat-button>\n                            <div id="dateElement" class ="smart-date-element">\n                                <div id="defaultHeaderDate"></div>\n                                <div id="classicHeaderDate">\n                                    <smart-drop-down-list class ="smart-month-element" id="monthElement" drop-down-position="bottom" selection-mode="one" disabled="[[disabled]]" readonly="[[readonly]]">\n                                    </smart-drop-down-list>\n                                    <input class ="smart-year-element" id="yearElement" disabled="[[disabled]]" readonly="[[readonly]]"/>\n                                    <span class ="smart-year-elements">\n                                        <smart-repeat-button class ="smart-increment-year-button" id="incrementYearButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">\n                                            <span class ="smart-arrow">&#xe801</span>\n                                        </smart-repeat-button>\n                                        <smart-repeat-button class ="smart-decrement-year-button" id="decrementYearButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">\n                                            <span class ="smart-arrow">&#xe804</span>\n                                        </smart-repeat-button>\n                                    </span>\n                                </div>\n                            </div>\n                            <smart-repeat-button class ="smart-next-month-button" id="nextMonthButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">\n                                <div class ="smart-arrow">&#xe810</div>\n                            </smart-repeat-button>\n                        </div>\n                        <div id="content" class ="smart-content">\n                           <div id="monthsContainer" class="smart-months-container">\n                              <div id="month" class="smart-calendar-month">\n                                   <div id="monthName" class="smart-month-name"></div>\n                                   <div id="weekTitles" class="smart-calendar-week-titles">\n                                       <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                   </div>\n                                   <div id="weeks">\n                                        <div class="smart-calendar-week">\n                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                        </div>\n                                        <div class ="smart-calendar-week">\n                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                       </div>\n                                       <div class="smart-calendar-week">\n                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                       </div>\n                                       <div class="smart-calendar-week">\n                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                       </div>\n                                       <div class="smart-calendar-week">\n                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                       </div>\n                                       <div class ="smart-calendar-week">\n                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\n                                       </div>\n                                   </div>\n                                </div>\n                            </div>\n                            <div id="dateViewContainer" class="smart-date-view-container smart-hidden">\n                                <div></div><div></div><div></div><div></div><div></div><div></div>\n                                <div></div><div></div><div></div><div></div><div></div><div></div>\n                            </div>\n                            <div id="monthsSeparator" class="smart-calendar-month-separator"></div>\n                            <div id="nextMonthsContainer" class="smart-next-months-container"></div>\n                            <smart-list-box item-height="30" unfocusable virtualized id="listViewContainer" selection-mode="one" class="smart-list-view smart-hidden"></smart-list-box>\n                            <div id="animationPanel" class="smart-calendar-animation-panel smart-hidden"></div>\n                        </div>\n                        <div id="footer" class ="smart-footer smart-hidden">\n                            <div id="selectedDatesRange"></div>\n                        </div>\n                        <smart-tooltip id="tooltip" open-mode="manual" arrow\n                                   tooltip-template="[[tooltipTemplate]]"\n                                   position="[[tooltipPosition]]"\n                                   delay="[[tooltipDelay]]"\n                                   disabled="[[disabled]]">\n                         </smart-tooltip>\n                        <input id="hiddenInput" type="hidden" name="[[name]]">\n                    </div>\n                </div>'}},{key:"propertyChangedHandler",value:function(e,a,n){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"propertyChangedHandler",this).call(this,e,a,n);var i=this;switch(e){case"animationSettings":i._applyAnimationSettings();break;case"disabled":case"unfocusable":i._setFocusable();break;case"calendarMode":i.displayMode="month",i._setCalendarMode(),i._setDisplayModeContent();break;case"dayNameFormat":i._setDayNames(i.$.month);break;case"dateFormatFunction":for(var s=i.$.monthsContainer.children,o=0;o<s.length;o++)s[o].firstElementChild.innerHTML=n?n(s[o]._date):i._monthsNames[s[o]._date.getMonth()]+" "+s[o]._date.toLocaleDateString(i.locale,{year:i.yearFormat});i._setHeader();break;case"displayMode":i._setDisplayMode(a,n);break;case"displayModeView":i._applyAnimationSettings(!0),"month"!==i.displayMode&&i._setDisplayModeContent();break;case"firstDayOfWeek":i._handleMonths(),i._setDayNames();break;case"hideTooltipArrow":i.$.tooltip.arrow=!n;break;case"titleTemplate":case"headerTemplate":case"footerTemplate":i._handleLayoutTemplate(i.$[e.split(/[T]/)[0]],n),"titleTemplate"===e?i._setTitle():"headerTemplate"===e?i._setHeader():i._setFooter();break;case"importantDates":i.importantDates=i._validateDate(n),i._setImportantDates();break;case"importantDatesTemplate":i._handleImportantDateTemplate(),i._setImportantDates();break;case"locale":i._setMonthNames(),i._setDayNames(),i._setHeader(),i._setTitle(),i._setFooter(),i.displayMode&&"month"!==i.displayMode&&i._setDisplayModeContent();break;case"max":case"min":i._validateMinMax(e,n,a),i._validateSelectedDates(),i._noFocusingRequired=!1,i._updateHeaderElements();break;case"months":i._handleMonths();break;case"monthNameFormat":i._setCalendarMode(),i._setHeader();break;case"restrictedDates":i._setRestrictedDates(i.restrictedDates=i._validateDate(n));break;case"rightToLeft":i._setDayNames(),i._handleMonths();break;case"scrollButtonsNavigationMode":i._setScrollButtonsNavigationMode();break;case"selectedDates":if(i._clearSelection(!0),i._validateSelectedDates(i._validateDate(n)),i._applySelectionMode(!0),i._dateInView){var r=i.selectedDates[i.selectedDates.length-1];i._isDateInView(r)?i.selectedDates.map(function(e){return i._selectDate(e,!0,!0)}):i._handleMonths(r)}i._setFooter(),i._setWeeksVisibility(i.$.monthsContainer),i.$.hiddenInput.value=i.selectedDates.toString(),i.$.fireEvent("change",{value:i.selectedDates}),i._setTitle();break;case"selectionMode":i._applySelectionMode(),i._setTitle();break;case"view":i._setTitle();break;case"viewSections":n.indexOf("title")>-1?i.$title.removeClass("smart-hidden"):i.$title.addClass("smart-hidden"),i._setTitle(),n.indexOf("header")>-1?i.$header.removeClass("smart-hidden"):i.$header.addClass("smart-hidden"),i._setHeader(),n.indexOf("footer")>-1?i.$footer.removeClass("smart-hidden"):i.$footer.addClass("smart-hidden"),i._setFooter();break;case"weeks":i._setWeeksVisibility(i.$.monthsContainer);break;case"yearFormat":if(i._setCalendarMode(),i._setFooter(),i.months>1&&"month"===i.displayMode)for(var l=i._animationStarted?i.$.nextMonthsContainer.children:i.$.monthsContainer.children,d=0;d<l.length;d++)l[d].firstElementChild.innerHTML=i.dateFormatFunction?i.dateFormatFunction(l[d]._date):i._monthsNames[l[d]._date.getMonth()]+" "+l[d]._date.toLocaleDateString(i.locale,{year:n});i._setTitle(),i._setHeader()}}},{key:"ready",value:function(){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"ready",this).call(this);var e=this;e._applyAnimationSettings(),e.importantDates=e._validateDate(e.importantDates),e.restrictedDates=e._validateDate(e.restrictedDates),e._setMonthNames(),e._validateMinMax(),e._validateSelectedDates(e._validateDate(e.selectedDates)),e._handleLayoutTemplate(e.$.title,e.titleTemplate),e._handleLayoutTemplate(e.$.header,e.headerTemplate),e._handleLayoutTemplate(e.$.footer,e.footerTemplate),e._handleImportantDateTemplate(),e._keysPressed={},e._setFocusable(),e._setDayNames(),e._applySelectionMode(!0),e._handleMonths(0===e.selectedDates.length?new Date((new Date).setHours(0,0,0,0)):e.selectedDates[e.selectedDates.length-1]),e.viewSections.indexOf("title")>-1?e.$title.removeClass("smart-hidden"):e.$title.addClass("smart-hidden"),e.viewSections.indexOf("header")>-1?e.$header.removeClass("smart-hidden"):e.$header.addClass("smart-hidden"),e.viewSections.indexOf("footer")>-1?e.$footer.removeClass("smart-hidden"):e.$footer.addClass("smart-hidden"),e._setScrollButtonsNavigationMode(),e._setCalendarMode(),e._setDisplayMode(),e._setTitle(),e._setFooter(),e.$.monthElement&&e.$.monthElement._setDropDownSize()}},{key:"clearSelection",value:function(){this._clearSelection()}},{key:"_setFocusable",value:function(){function e(e,n){if(n){var i=t.$.header.getElementsByClassName(e.className)[0];return i&&i instanceof n?("function"==typeof i._setFocusable&&i.isCompleted?i.unfocusable=a<=-1:i.setAttribute("tabindex",a),i):void 0}}var t=this,a=t.tabIndex>0?t.tabIndex:0;(t.disabled||t.readonly||t.unfocusable)&&(a=-1),t.$.previousMonthButton=e(t.$.previousMonthButton,Smart.Button),t.$.nextMonthButton=e(t.$.nextMonthButton,Smart.Button),t.$.incrementYearButton=e(t.$.incrementYearButton,Smart.Button),t.$.decrementYearButton=e(t.$.decrementYearButton,Smart.Button),t.$.monthElement=e(t.$.monthElement,Smart.DropDownList),t.$.yearElement=e(t.$.yearElement,HTMLInputElement),t.viewSections.indexOf("title")>-1&&(t.$.dateContainer.setAttribute("tabindex",a),t.$.yearContainer.setAttribute("tabindex",a)),t.$.content.setAttribute("tabindex",a),t.$.dateElement.setAttribute("tabindex","default"===t.calendarMode?a:-1),t.tabIndex=t.readonly&&!t.disabled?t.tabIndex>0?t.tabIndex:0:a}},{key:"navigate",value:function(e){var t=this;if(e=parseInt(e),!isNaN(e)){var a=t._getNextDate(e);if(a)return"month"!==t.displayMode?(t.$.hasClass("animation")?(t.$nextMonthsContainer.addClass("smart-date-view-container"),"list"===t.displayModeView?t._setDisplayModeContent(a):t._animateNavigation(a,e)):t._setDisplayModeContent(a),!0):(t.$.hasClass("animation")?(t._animateNavigation(a,e),t.$nextMonthsContainer.hasClass("smart-date-view-container")&&t.$nextMonthsContainer.removeClass("smart-date-view-container")):(t._handleMonths(a),t._updateHeaderElements(),t._setHeader()),!0)}}},{key:"select",value:function(e){var t=this;void 0!==t._dateInView[0]&&"none"!==t.selectionMode&&e&&(e=t._validateDate(e)[0])instanceof Date&&("one"===t.selectionMode&&t.selectedDates.map(Number).indexOf(e.getTime())>-1||e.getTime()<t.min.getTime()||e.getTime()>t.max.getTime()||("one"!==t.selectionMode&&"default"!==t.selectionMode&&"zeroOrOne"!==t.selectionMode||t._clearSelection(!0),t._selectDate(e),1!==t.selectedDates.length||t._isDateInView(t.selectedDates[0])||t._handleMonths(t.selectedDates[0])))}},{key:"today",value:function(){var e=this,t=new Date;return t.setHours(0,0,0,0),t.getTime()<e.min.getTime()||t.getTime()>e.max.getTime()?t=new Date(e.max):e.selectedDates=[t],e._handleMonths(t),t}},{key:"_animateNavigation",value:function(e,t,a){function n(){var e=t>0?i.$.content[i._animationSettings.scrollSize]>=o:0===i.$.content[i._animationSettings.scrollSize],a=i._scrollStep/2;if(e)return void i._animateNavigationCompleted();t>0&&i.$.content[i._animationSettings.scrollSize]>o*i._animationSettings.easeThreshold?(a=Math.max(i.$.content[i._animationSettings.scrollSize]/i._animationSettings.stepEaseSize,Math.abs(a-(o-i.$.content[i._animationSettings.scrollSize])*i._animationSettings.step)),i._scrollStep=i._scrollStep*i._animationSettings.step+a):t<0&&i.$.content[i._animationSettings.scrollSize]<o*i._animationSettings.easeThreshold&&(a=Math.max(i.$.content[i._animationSettings.scrollMax]/i._animationSettings.stepEaseSize,Math.abs(a-i.$.content[i._animationSettings.scrollSize]*i._animationSettings.step)),i._scrollStep=i._scrollStep*i._animationSettings.step+a),i.$.content[i._animationSettings.scrollSize]+=t>0?i._scrollStep:-i._scrollStep,i._animationId=requestAnimationFrame(n)}var i=this;i._animationSettings||i._applyAnimationSettings(),i.$animationPanel.addClass("smart-hidden"),i.$.dateViewContainer.style.transform="",i.$.dateViewContainer.style.opacity="",i.$.monthsContainer.style.transform="",i.$.monthsContainer.style.opacity="";var s="month"!==i.displayMode?i.$.dateViewContainer:i.$.monthsContainer,o=i.$.content[i._animationSettings.scrollMax]-i.$.content[i._animationSettings.size];i._scrollStep=i.$.content[i._animationSettings.size]*i._animationSettings.startSpeed,i._animationStarted=!0,"month"!==i.displayMode?(i._focusedDate.focused=!1,i._focusedDate.removeAttribute("focused"),i._setDisplayModeContent(e,i.$.nextMonthsContainer)):i._handleMonths(e,i.$.nextMonthsContainer),a||(t>0?(s.style.order=1,i.$.nextMonthsContainer.style.order=3,(!i._animationStarted||i._animationStarted&&i.$.content[i._animationSettings.scrollSize]>i.$.content[i._animationSettings.scrollMax]*i._animationSettings.resetThreshold*2)&&(i.$.content[i._animationSettings.scrollSize]=0)):(s.style.order=3,i.$.nextMonthsContainer.style.order=1,(!i._animationStarted||i._animationStarted&&i.$.content[i._animationSettings.scrollSize]<i.$.content[i._animationSettings.scrollMax]*i._animationSettings.resetThreshold)&&(i.$.content[i._animationSettings.scrollSize]=i.$.content[i._animationSettings.scrollMax]))),cancelAnimationFrame(i._animationId),i._animationId=requestAnimationFrame(n)}},{key:"_animateNavigationCompleted",value:function(){var e=this,t="month"!==e.displayMode?e.$.dateViewContainer:e.$.monthsContainer;cancelAnimationFrame(e._animationId);var a=e._focusedDate?e._focusedDate.value:void 0;a&&(e._focusedDate.focused=!1,e._focusedDate.removeAttribute("focused"));var n=void 0,i=void 0;if("month"!==e.displayMode){t.innerHTML=e.$.nextMonthsContainer.innerHTML,n=t.children,i=e.$.nextMonthsContainer.children;for(var s=0;s<n.length;s++)n[s].value=i[s].value}else{for(var o=t.children,r=e.$.nextMonthsContainer.children,l=0;l<o.length;l++){o[l]._date=r[l]._date,o[l].innerHTML=r[l].innerHTML,n=e._getMonthDays(o[l]).days,i=e._getMonthDays(r[l]).days;for(var d=0;d<n.length;d++)n[d].value=i[d].value}e._selectedDates.length>0&&(e._selectedDates=e._selectedDates.map(function(t){return t=e._getDayInstanceByValue(t.value)}).filter(function(e){return void 0!==e}))}e._focusDate(e._getDayInstanceByValue(a)),t.style.order=1,e.$.nextMonthsContainer.style.order=3,e.$.content[e._animationSettings.scrollSize]=0,e._animationStarted=!1}},{key:"_applyAnimationSettings",value:function(e){var t=this;if(!t.$.hasClass("animation"))return void delete t._animationSettings;t._animationSettings=t.animationSettings?t.animationSettings:t._animationSettings?t._animationSettings:{},"portrait"===t.scrollButtonsNavigationMode?(t._animationSettings.scrollMax="scrollHeight",t._animationSettings.size="offsetHeight",t._animationSettings.scrollSize="scrollTop"):(t._animationSettings.scrollMax="scrollWidth",t._animationSettings.size="offsetWidth",t._animationSettings.scrollSize="scrollLeft"),e||(t._animationSettings.startSpeed=t._animationSettings.startSpeed?t._animationSettings.startSpeed:.2,t._animationSettings.easeThreshold=t._animationSettings.easeThreshold?t._animationSettings.easeThreshold:.5,t._animationSettings.step=t._animationSettings.step?t._animationSettings.step:.25,t._animationSettings.stepEaseSize=t._animationSettings.stepEaseSize?t._animationSettings.stepEaseSize:200,t._animationSettings.resetThreshold=t._animationSettings.resetThreshold?t._animationSettings.resetThreshold:.2)}},{key:"_applySelectionMode",value:function(e){var t=this,a=[],n=!!e;switch(t.selectionMode){case"none":return void t._clearSelection(n);case"many":case"default":case"oneOrMany":if(0===t.selectedDates.length){a.push(new Date(Math.min(Math.max(t.min.getTime(),(new Date).setHours(0,0,0,0)),t.max.getTime())));break}return;case"one":if(1===t.selectedDates.length)return;t.selectedDates.length>1?(a.push(t.selectedDates[t.selectedDates.length-1]),t._clearSelection(n)):a.push(new Date(Math.min(Math.max(t.min.getTime(),(new Date).setHours(0,0,0,0)),t.max.getTime())));break;case"zeroOrOne":if(t.selectedDates.length>1){a.push(t.selectedDates[t.selectedDates.length-1]),t._clearSelection(n);break}return;case"zeroOrMany":return;case"week":if(t.selectedDates.length>=1){for(var i=t.selectedDates[t.selectedDates.length-1],s=0;s<8;s++)a.push(new Date(i)),i.setDate(i.getDate()+1);t._clearSelection(n)}}if(t.selectedDates=[],e)return void(t.selectedDates=a);for(var o=a.length,r=0;r<o;r++)t._selectDate(a[r],r<o-1)}},{key:"_clearSelection",value:function(e){var t=this;if(t._selectedDates&&t._selectedDates.map(function(e){e.selected=!1,e.removeAttribute("selected")}),t.selectedDates=[],t._selectedDates=[],"many"===t.selectionMode)for(var a=t.$.monthsContainer.children,n=0;n<a.length;n++)t._getMonthDays(a[n]).days.map(function(e){return e.classList.remove("hovered")});t._setFooter(),t.$.hiddenInput.value=t.selectedDates.toString(),e||t.$.fireEvent("change",{value:[]}),t._setTitle()}},{key:"_contentStateHandler",value:function(e){var t=this;return"blur"===e.type||"focus"===e.type&&t._noFocusingRequired?(t._noFocusingRequired=!1,t._focusedDate.focused=!1,void t._focusedDate.removeAttribute("focused")):"month"!==t.displayMode?void(t._focusedDate&&t._focusedDate instanceof HTMLDivElement&&t._focusedDate.setAttribute("focused","")):void("focus"===e.type&&t._focusDate())}},{key:"_containerWheelHandler",value:function(e){var t=this;if(!t.disabled&&!t.readonly){var a=void 0;t.$.yearElement===document.activeElement&&(a=12),document.activeElement.closest("smart-calendar")===t&&(a=e.target===t.$.yearElement?12:1),a&&(e.preventDefault(),a=12===a?a:a*t.months,e.deltaY>0?t.navigate(-a):t.navigate(a))}}},{key:"_downHandler",value:function(e){var t=this,a=e.originalEvent.target;if(t._dragStartDetails=void 0,!t.disabled&&!t.readonly){if(t.className.indexOf("material")>-1&&(a.value instanceof Date||a.parentElement&&a.parentElement.classList.contains("smart-calendar-title")||a.parentElement===t.$.dateElement||a.closest("smart-repeat-button"))&&Smart.Utilities.Animation.Ripple.animate(a,e.pageX,e.pageY),a=e.originalEvent.target.closest(".smart-header"),e.originalEvent.target.closest(".smart-year-container")&&"decade"!==t.displayMode)return void t._showDateView("year");if(e.originalEvent.target.closest(".smart-date-container")&&"month"!==t.displayMode)return void t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedDate,"month");if(t._animationStarted&&t._animateNavigationCompleted(),Smart.Utilities.Core.isMobile&&(!a||a!==t.$.header))return void(t._dragStartDetails={x:e.pageX,y:e.pageY,startTime:Date.now(),target:e.originalEvent.target});if(a=e.originalEvent.target,a.closest(".smart-calendar-week")||a.parentElement===t.$.dateViewContainer){for(;a&&!(a.value instanceof Date);)a=a.parentElement;return void(a&&("month"!==t.displayMode?t._displayModeHandler(a):t._weeksDownHandler(a)))}if(e.originalEvent.stopPropagation(),"list"===t.displayModeView&&"month"!==t.displayMode)return void((a=e.originalEvent.target.closest("smart-list-item"))&&t._displayModeHandler(a));t.focus()}}},{key:"_displayModeHandler",value:function(e,t){var a=this;if(e instanceof HTMLElement&&e.parentElement.classList.contains("smart-calendar-week")&&e.classList.contains("smart-other-month-date")){if("decade"===a.displayMode&&(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()>a.max.getFullYear()))return;if("year"===a.displayMode&&(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()===a.min.getFullYear()&&e.value.getMonth()<a.min.getMonth()||e.value.getFullYear()>a.max.getFullYear()||e.value.getFullYear()===a.max.getFullYear()&&e.value.getMonth()>a.max.getMonth()))return}switch(t=t||a.displayMode){case"year":t="month";break;case"decade":t="year"}if(a.displayMode!==t){a.$.fireEvent("displayModeChanging",{oldDisplayMode:a.displayMode,newDisplayMode:t}).defaultPrevented||(a.displayMode=t,e.parentElement!==a.$.dateViewContainer||e.disabled||e.restricted||a._focusDate(e),a.$.hasClass("animation")?(e instanceof Smart.ListItem||e.ownerListBox===a.$.listViewContainer?e.offsetHeight?a.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(e.dataItem.top>0?e.offsetTop-e.offsetHeight/2:e.offsetTop+e.offsetHeight/2)+"px":a.$.animationPanel.style.transformOrigin=a.$.listViewContainer.offsetLeft+a.$.listViewContainer.offsetWidth/2+"px "+(a.$.listViewContainer.offsetTop+a.$.listViewContainer.offsetHeight/2)+"px":(e=a._focusedDate,a.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(e.offsetTop+e.offsetHeight/2)+"px"),a._animateView(1,e)):a._setDisplayModeContent(e.value instanceof Date?e.value:new Date(e.value)))}}},{key:"_animateView",value:function(e,t){function a(){if((e>0&&o>=3.5||e<0&&o<=0)&&(s=!0),s)return cancelAnimationFrame(n._animationId),n.$animationPanel.addClass("smart-hidden"),n.$.animationPanel.style.transform="",n.$.animationPanel.style.opacity="",d.style.transform="",d.style.opacity="",void("month"===n.displayMode?n.$.content.focus():"list"===n.displayModeView&&n.focus());n.$.animationPanel.style.opacity=r,d.style.opacity=1-r,r-=.05,e>0?(n.$.animationPanel.style.transform="scale("+o+")",d.style.transform="scale("+Math.min((o-1)/2,1)+")",o+=.125):(n.$.animationPanel.style.transform="scale("+Math.max(o,0)+")",d.style.transform="scale("+Math.max(1+o,1)+")",o-=.06),n._animationId=requestAnimationFrame(a)}var n=this,i=t instanceof Date?t:new Date(t.value),s=!1,o=1,r=1,l=void 0,d=void 0;if("list"===n.displayModeView?(l=t instanceof Smart.ListItem||t.ownerListBox===n.$.listViewContainer?n.$.listViewContainer:"month"!==n.displayMode?n.$.monthsContainer:n.$.listViewContainer,d="month"===n.displayMode?n.$.monthsContainer:n.$.listViewContainer):t.value instanceof Date||(t=n._focusedDate?n._focusedDate:n._selectedDates.length>0?n._selectedDates[n._selectedDates.length-1]:n._getDayInstanceByValue(new Date)),l||(l=t.parentElement===n.$.dateViewContainer?n.$.dateViewContainer:n.$.monthsContainer),d||(d="month"===n.displayMode?n.$.monthsContainer:n.$.dateViewContainer),d.style.transformOrigin=n.$.animationPanel.style.transformOrigin,l instanceof Smart.ListBox){n.$.animationPanel.innerHTML="";var m=l.cloneNode(!1);m.dataSource=l.dataSource,n.$.animationPanel.appendChild(m)}else n.$.animationPanel.innerHTML=l.innerHTML;if(n._setDisplayModeContent(i),n.$.animationPanel.style.width=n.$.content.offsetWidth+"px",n.$.animationPanel.style.height=n.$.content.offsetHeight+"px",n.$.animationPanel.style.transform="scale(1)",n.$.animationPanel.style.opacity=1,n.$animationPanel.removeClass("smart-hidden"),d.style.opacity="0",d.style.transform="scale(3.5)",l.$.hasClass("smart-date-view-container")?n.$animationPanel.addClass("smart-date-view-container"):n.$animationPanel.removeClass("smart-date-view-container"),l instanceof Smart.ListBox){var c=n.$.animationPanel.children[0];c.whenReady(function(){c._refreshLayout(),c.ensureVisible(c.selectedValues[0])})}cancelAnimationFrame(n._animationId),n._animationId=requestAnimationFrame(a)}},{key:"_documentUpHandler",value:function(e){var t=this;if(Smart.Utilities.Core.isMobile&&t._dragStartDetails){var a=Date.now(),n=e.originalEvent.target,i={};if("portrait"===t.scrollButtonsNavigationMode?(i.coordinate="y",i.direction="pageY"):(i.coordinate="x",i.direction="pageX"),Math.abs(t._dragStartDetails[i.coordinate]-e[i.direction])<=10){if(!(n="list"===t.displayModeView&&"month"!==t.displayMode?n.closest("smart-list-item"):n))return void(t._dragStartDetails=void 0);if("month"!==t.displayMode)return t._displayModeHandler(n),"portrait"===t.scrollButtonsNavigationMode?t.$.content.scrollTop=0:t.$.content.scrollLeft=0,void(t._dragStartDetails=void 0);if(t._weeksDownHandler(n),!t.disableAutoNavigation&&n.classList.contains("smart-other-month-date"))return}else{var s=Math.abs((e[i.direction]-t._dragStartDetails[i.coordinate])/(a-t._dragStartDetails.startTime));if(s>1){for(var o=parseInt(s),r=0;r<o;r++)t.navigate(t._dragStartDetails.step);return void(t._dragStartDetails=void 0)}}if(!t.$.hasClass("animation"))return void(t._dragStartDetails=void 0);var l=("month"!==t.displayMode?t.$.dateViewContainer[t._animationSettings.scrollMax]:t.$.monthsContainer[t._animationSettings.scrollMax])+t.$.monthsSeparator[t._animationSettings.size];if(t._dragStartDetails.step>0&&t.$.content[t._animationSettings.scrollSize]>l*t._animationSettings.easeThreshold||t._dragStartDetails.step<0&&t.$.content[t._animationSettings.scrollSize]<l*t._animationSettings.easeThreshold)return t._animateNavigation(t._dragStartDetails.navigationDate,t._dragStartDetails.step,!0),void(t._dragStartDetails=void 0);t._animateMonthRepositioning(void 0,t._dragStartDetails.step),t._dragStartDetails=void 0}}},{key:"_animateMonthRepositioning",value:function(e,t){function a(){var e=t<0?n.$.content[n._animationSettings.scrollSize]>=s:0===n.$.content[n._animationSettings.scrollSize],o=n._scrollStep/2;if(e)return cancelAnimationFrame(n._animationId),i.style.order=1,n.$.nextMonthsContainer.style.order=3,n.$.content[n._animationSettings.scrollSize]=0,void(n._animationStarted=!1);t>0?(o=Math.max(n.$.content[n._animationSettings.scrollMax]/n._animationSettings.stepEaseSize,Math.abs(o-n.$.content[n._animationSettings.scrollSize]*n._animationSettings.step)),n._scrollStep=n._scrollStep*n._animationSettings.step+o):(o=Math.max(n.$.content[n._animationSettings.scrollMax]/n._animationSettings.stepEaseSize,Math.abs(o-(s-n.$.content[n._animationSettings.scrollSize])*n._animationSettings.step)),n._scrollStep=n._scrollStep*n._animationSettings.step+o),n.$.content[n._animationSettings.scrollSize]+=t<0?n._scrollStep:-n._scrollStep,n._animationId=requestAnimationFrame(a)}var n=this,i="month"!==n.displayMode?n.$.dateViewContainer:n.$.monthsContainer;n._animationSettings||n._applyAnimationSettings();var s=i[n._animationSettings.scrollMax]+n.$.monthsSeparator[n._animationSettings.size];n._scrollStep=n.$.content[n._animationSettings.size]*n._animationSettings.startSpeed,cancelAnimationFrame(n._animationId),n._animationId=requestAnimationFrame(a),n._animationStarted=!0}},{key:"_focusDate",value:function(e){var t=this;if(t._focusedDate&&(t._focusedDate.focused=!1,t._focusedDate.removeAttribute("focused")),!t.disabled&&!t.readonly){if(e){if("month"!==t.displayMode)return e.focused=!0,e.setAttribute("focused",""),void(t._focusedDate=e);if(e.disabled||e.restricted)return;return e.focused=!0,e.setAttribute("focused",""),t._focusedDate=e,void t._updateWeeksVisibility(t._focusedDate)}if("month"===t.displayMode||0!==t.$.monthsContainer.offsetHeight){if(t._selectedDates.length>0)t._selectedDates[t._selectedDates.length-1].focused=!0,t._selectedDates[t._selectedDates.length-1].setAttribute("focused",""),t._focusedDate=t._selectedDates[t._selectedDates.length-1];else{var a=t.$.monthsContainer.children;if(t.min.getTime<a[0]._date.getTime())return;for(var n=t._getMonthDays(a[0],t.rightToLeft).days,i=0;i<n.length;i++)if(0===n[i].classList.length){if(n[i].disabled||n[i].restricted)continue;t._focusedDate=n[i];break}}t._focusedDate&&(t._focusedDate.focused=!0,t._focusedDate.setAttribute("focused",""),t._updateWeeksVisibility(t._focusedDate))}}}},{key:"_getDays",value:function(e,t){var a=t.length,n=[];if(a>0)for(var i=0;i<a;i++)t[i].getFullYear()===e.getFullYear()&&t[i].getMonth()===e.getMonth()&&n.push(t[i].getDate());return n}},{key:"_getDayInstanceByValue",value:function(e,t){var a=this;if(e instanceof Date)if(t||(t=a.$.monthsContainer),"month"===a.displayMode){for(var n=void 0,i=void 0,s=t.children,o=0;o<s.length;o++)if(e.getFullYear()===s[o]._date.getFullYear()&&e.getMonth()===s[o]._date.getMonth()){n=s[o];break}if(n){i=a._getMonthDays(n).days;for(var r=0;r<i.length;r++)if((!(i[r].hasAttribute("class")&&i[r].getAttribute("class").length>0)||i[r].classList.contains("hovered"))&&i[r].value.getDate()===e.getDate())return i[r]}}else{if("list"===a.displayModeView)return;for(var l=arguments[1]?a.$.nextMonthsContainer.children:a.$.dateViewContainer.children,d=0;d<l.length;d++)if("year"!==a.displayMode){if(l[d].value.getFullYear()===e.getFullYear())return l[d]}else if(l[d].value.getMonth()===e.getMonth())return l[d]}}},{key:"_getMonthDays",value:function(e,t){var a=e.getElementsByClassName("smart-calendar-week"),n=a.length,i=[];if(t)for(var s=0;s<n;s++)for(var o=a[s].children,r=o.length-1;r>0;r--)i.push(o[r]);else for(var l=0;l<n;l++)for(var d=a[l].children,m=1;m<d.length;m++)i.push(d[m]);return{days:i,weeks:[].slice.call(a)}}},{key:"_getWeekNumber",value:function(e){var t=this,a=new Date(e.getFullYear(),0,1),n=Math.round((e.getTime()-a.getTime()-6e4*(e.getTimezoneOffset()-a.getTimezoneOffset()))/864e5)+1,i=a.getDay()-t.firstDayOfWeek,s=void 0;return i=i>=0?i:i+7,i<4?(s=Math.floor((n+i-1)/7)+1)>52&&(a=new Date(e.getFullYear()+1,0,1),i=a.getDay()-t.firstDayOfWeek,i=i>=0?i:i+7,
s=i<4?1:53):s=Math.round((n+i-1)/7),s}},{key:"_handleDateSelection",value:function(e){function t(e,t){if(a._clearSelection(!0),e.getTime()<t.value.getTime())for(;e.getTime()<=t.value.getTime();)a._selectDate(e,!0),e.setDate(e.getDate()+1);else if(e.getTime()>t.value.getTime())for(;e.getTime()>=t.value.getTime();)a._selectDate(e,!0),e.setDate(e.getDate()-1);else a._selectDate(t,!0);a.$.hiddenInput.value=a.selectedDates.toString(),a._setFooter(),a.$.fireEvent("change",{value:a.selectedDates}),a._setTitle()}var a=this;if(void 0!==e&&!e.disabled&&!e.restricted){var n=a._selectedDates;switch(a.selectionMode){case"none":a._focusDate(e);break;case"one":case"default":if(a._keysPressed.Control)return a.selectedDates.length>1||1===a.selectedDates.length&&!e.selected?void a._selectDate(e):void a._focusDate(e);if(a._keysPressed.Shift)return void t(new Date(a.selectedDates[0]),e);a._clearSelection(!0),a._selectDate(e,n.indexOf(e)>-1);break;case"many":if(0===a.selectedDates.length)return void a._selectDate(e);var i=a.selectedDates[a.selectedDates.length-1],s=new Date(a.selectedDates[0]);if(e.value.getTime()===s.getTime()||e.value.getTime()===i.getTime())return a._clearSelection(),void a._focusDate(e);a.selectedDates.length>0&&t(s,e);break;case"zeroOrMany":a._selectDate(e);break;case"oneOrMany":if(1===a.selectedDates.length&&e.selected)return void a._focusDate(e);a._selectDate(e);break;case"zeroOrOne":if(1===a.selectedDates.length&&e.selected)return void a._selectDate(e);a._clearSelection(!0),a._selectDate(e);break;case"week":if(e.selected&&(e.value.getTime()===a.selectedDates[0].getTime()||e.value.getTime()===a.selectedDates[a.selectedDates.length-1].getTime()))return a._clearSelection(),void a._focusDate(e);a._clearSelection(!0);var o=new Date(e.value);a._selectDate(o);for(var r=1;r<8;r++)o.setDate(o.getDate()+1,r<7),a._selectDate(o);a._isDateInView(o)||a.navigate(1)}}}},{key:"_handleImportantDateTemplate",value:function(){var e=this;if(e._importantDatesTemplate=e._validateTemplate("importantDatesTemplate",e.importantDatesTemplate),e._importantDatesTemplate&&e._importantDatesTemplate.content){var t=e._importantDatesTemplate.content,a=t.childNodes.length,n=/{{\w+}}/g,i=void 0;e._bindingDetails=[];for(var s=0;s<a;s++)if(i=n.exec(t.childNodes[s].innerHTML))return void e._bindingDetails.push({childNodeIndex:s,bindingString:i[0]})}}},{key:"_handleLayoutTemplate",value:function(e,t){var a=this,n=a._validateTemplate(e.$.hasClass("smart-header")?"headerTemplate":e.$.hasClass("smart-footer")?"footerTemplate":"titleTemplate",t);if(n&&n.content){a._layoutTemplates||(a._layoutTemplates=[]);var i=document.importNode(n.content,!0);e.innerHTML="";for(var s=i.childNodes.length,o=/{{\w+}}/g,r=void 0,l=[],d=0;d<s;d++)(r=o.exec(i.childNodes[d].innerHTML))&&l.push({childNodeIndex:d,bindingString:r[0]});a._layoutTemplates=a._layoutTemplates.filter(function(t){return t.selector!==e}),a._layoutTemplates.push({selector:e,template:n,bindings:l}),e.appendChild(i)}}},{key:"_handleItemHoveredState",value:function(e,t){var a=this;if(!a._animationStarted){if("month"===a.displayMode)if("mouseover"===e.type&&"many"===a.selectionMode&&a.selectedDates.length>0){for(var n=a.$.monthsContainer.children,i=0;i<n.length;i++)a._getMonthDays(n[i]).days.map(function(e){return e.classList.remove("hovered")});var s=new Date(a.selectedDates[0]),o=new Date(t.value),r=t,l=s.getTime()>o.getTime()?-1:1,d=function(){!(r=a._getDayInstanceByValue(s,a.$.monthsContainer))||r.selected||r.restricted||r.classList.add("hovered")};if(s.getTime()!==o.getTime()){for(s.setDate(s.getDate()+l);s.getTime()!==o.getTime();)d(),s.setDate(s.getDate()+l);d()}}else t.classList.remove("hovered");"mouseover"!==e.type||t.classList.contains("smart-other-month-date")?t.classList.remove("hovered"):t.classList.add("hovered")}}},{key:"_handleMonths",value:function(e,t){function a(e){var t=void 0,a=e.children.length,n=document.createDocumentFragment();for(a;a<i.months;a++)t=i.$.month.cloneNode(!1),t.innerHTML=i.$.month.innerHTML,n.appendChild(t);return n}function n(t){for(var a=t.children,n=0;n<a.length;n++)i._setMonth(e,a[n]),e.setMonth(e.getMonth()+1);i._setWeeksVisibility(t),i._updateHeaderElements(),i._setHeader(),i.tooltip&&i.$.tooltip.close(),i.$.content===document.activeElement&&i._focusDate()}var i=this,s=void 0;if(e||(e=i._dateInView&&i._dateInView.length>0?i._dateInView[0]:new Date),e=new Date(Math.min(Math.max(i.min.getTime(),e.getTime()),i.max.getTime())),t||(t=i.$.monthsContainer),i._selectedDates=[],i.$.hasClass("animation")){for(s=i.$.nextMonthsContainer.children,s.length>0&&s[0].value instanceof Date&&(i.$.nextMonthsContainer.innerHTML="");i.$.nextMonthsContainer.childElementCount<i.months;)i.$.nextMonthsContainer.appendChild(a(i.$.nextMonthsContainer));for(;i.$.nextMonthsContainer.childElementCount>i.months;)i.$.nextMonthsContainer.removeChild(s[i.$.nextMonthsContainer.childElementCount-1]);if(arguments[1]===i.$.nextMonthsContainer)return void n(i.$.nextMonthsContainer)}if(s=i.$.monthsContainer.children,s.length>i.months){for(;i.$.monthsContainer.childElementCount>i.months;)i.$.monthsContainer.removeChild(s[i.$.monthsContainer.childElementCount-1]),i._dateInView.pop();return void n(i.$.monthsContainer)}if(i.$.monthsContainer.children.length===i.months)return void n(i.$.monthsContainer);i._dateInView=[],i.$.monthsContainer.appendChild(a(i.$.monthsContainer)),n(i.$.monthsContainer)}},{key:"_headerChangeHandler",value:function(e){var t=this;if(e.stopPropagation(),!t.disabled&&!t.readonly){if(e.target.ownerElement===t.$.monthElement&&0!==t._changeEventFired)return void t._changeEventFired--;e.target===t.$.yearElement&&(t._dateInView[0].setFullYear(Math.min(Math.max(t.min.getFullYear(),isNaN(parseInt(t.$.yearElement.value))?0:parseInt(t.$.yearElement.value)),t.max.getFullYear())),t._handleMonths(t._dateInView[0])),t.$.monthElement&&e.target.ownerElement===t.$.monthElement&&t._handleMonths(new Date(t.$.monthsContainer.children[0]._date.getFullYear(),t.$.monthElement.selectedIndexes[0],1))}}},{key:"_headerClickHandler",value:function(e){var t=this;if(!t.disabled&&!t.readonly){var a=e.target.closest("smart-repeat-button");if(!a||!a.disabled){switch(a){case t.$.previousMonthButton:return void t.navigate(-1*t.months);case t.$.nextMonthButton:return void t.navigate(1*t.months);case t.$.decrementYearButton:return void t.navigate(-12);case t.$.incrementYearButton:return void t.navigate(12)}if("classic"===t.calendarMode)return void(t.displayMode="month");e.target.closest(".smart-date-element")&&(t._animationStarted&&t._animateNavigationCompleted(),t._showDateView())}}}},{key:"_setDisplayMode",value:function(e,t,a){var n=this;if(0===arguments.length||!n.$.hasClass("animation")){if("classic"===n.calendarMode)return void(n.displayMode="month");if("month"!==n.displayMode&&(n.$monthsContainer.addClass("smart-hidden"),n.$dateViewContainer.hasClass("smart-hidden")&&n.$dateViewContainer.removeClass("smart-hidden")),!n.isCompleted&&"month"===n.displayMode)return;return void n._setDisplayModeContent()}if(n._animationStarted&&(n.displayMode=e,n._animateNavigationCompleted(),n.displayMode=t),"month"===e&&"year"===t||"year"===e&&"decade"===t)n.displayMode=e,n._showDateView(a?void 0:n.displayMode);else if("month"===e&&"decade"===t)n._showDateView(n.displayMode="year");else{var i=void 0;"list"===n.displayModeView?(i=n.$.listViewContainer.querySelectorAll("smart-list-item[selected]")[0],n.$.animationPanel.style.transformOrigin=i.offsetLeft+i.offsetWidth/2+"px "+(i.dataItem.top>0?i.offsetTop-i.offsetHeight/2:i.offsetTop+i.offsetHeight/2)+"px"):(i=n._focusedDate,n.$.animationPanel.style.transformOrigin=i.offsetLeft+i.offsetWidth/2+"px "+(i.offsetTop+i.offsetHeight/2)+"px"),n._animateView(1,i)}}},{key:"_setDisplayModeContent",value:function(e,t){var a=this,n=e&&"Invalid Date"!==e.toString()?e:a.selectedDates.length>0?a.selectedDates[a.selectedDates.length-1]:new Date;n.setTime(Math.min(Math.max(n.getTime(),a.min.getTime()),a.max.getTime())),n.setHours(0,0,0,0);var i=a._prepareView(n);if(i){var s=void 0;t?(a.$.nextMonthsContainer.innerHTML=a.$.dateViewContainer.innerHTML,s=a.$.nextMonthsContainer):s=a.$.dateViewContainer;for(var o=s.children,r=void 0,l=0;l<o.length;l++)o[l].innerHTML=i.viewContent[l],o[l].value=i.dates[l],"year"===a.displayMode?(o[l].value.getFullYear()<a.min.getFullYear()||o[l].value.getFullYear()===a.min.getFullYear()&&o[l].value.getMonth()<a.min.getMonth()||o[l].value.getFullYear()>a.max.getFullYear()||o[l].value.getFullYear()===a.max.getFullYear()&&o[l].value.getMonth()>a.max.getMonth()?o[l].classList.add("smart-other-month-date"):o[l].classList.remove("smart-other-month-date"),n.getFullYear()===o[l].value.getFullYear()&&n.getMonth()===o[l].value.getMonth()&&(r=o[l])):"decade"===a.displayMode&&(0===l||l===o.length-1||o[l].value.getFullYear()<a.min.getFullYear()||o[l].value.getFullYear()>a.max.getFullYear()?o[l].classList.add("smart-other-month-date"):o[l].classList.remove("smart-other-month-date"),n.getFullYear()===o[l].value.getFullYear()&&(r=o[l])),o[l].classList.remove("hovered");if(r.classList.contains("smart-other-month-date"))for(var d=0;d<o.length;d++)if(!o[d].classList.contains("smart-other-month-date")){r=o[d];break}a._focusedDate&&(a._focusedDate.focused=!1,a._focusedDate.removeAttribute("focused")),r.focused=!0,r.setAttribute("focused",""),a._focusedDate=r,a._setHeader(),a._updateHeaderElements(),a.$.fireEvent("displayModeChange"),setTimeout(function(){a.$.content.focus()},0)}}},{key:"_prepareView",value:function(e){function t(e,t,a){var n=new Date(e,t+1,0),i=n.getDate();return a>i?n.setDate(i):n.setDate(a),n}var a=this,n=[],i=[],s=void 0,o=void 0;if("month"===a.displayMode)return a.$nextMonthsContainer.hasClass("smart-date-view-container")&&a.$nextMonthsContainer.removeClass("smart-date-view-container"),a.$listViewContainer.addClass("smart-hidden"),a.$dateViewContainer.hasClass("smart-visibility-hidden")&&a.$dateViewContainer.removeClass("smart-visibility-hidden"),a._isDateInView(e)||a._handleMonths(e),a.$header.hasClass("smart-hidden")&&a.$header.removeClass("smart-hidden"),a.$content.hasClass("smart-calendar-list-view")&&a.$content.removeClass("smart-calendar-list-view"),a.$dateContainer.addClass("smart-selected"),a.$yearContainer.removeClass("smart-selected"),a.$dateViewContainer.addClass("smart-hidden"),a.$monthsContainer.removeClass("smart-hidden"),a._setHeader(),a.$.content.setAttribute("tabindex",a.tabIndex>0?a.tabIndex:0),a._updateHeaderElements(),a.$.content.focus(),a._focusDate(a._getDayInstanceByValue(e)),void a.$.fireEvent("displayModeChange");if("list"===a.displayModeView)return a._setDisplayModeListContent(e),void a.$.fireEvent("displayModeChange");if(a.$header.hasClass("smart-hidden")&&a.$header.removeClass("smart-hidden"),a.$dateViewContainer.hasClass("smart-visibility-hidden")&&a.$dateViewContainer.removeClass("smart-visibility-hidden"),a.$listViewContainer.addClass("smart-hidden"),a.$.content.setAttribute("tabindex",a.tabIndex>0?a.tabIndex:0),"year"===a.displayMode)for(var r=new Date,l=0;l<12;l++)r=t(r.getFullYear(),l,r.getDate()),n.push(r.toLocaleDateString(a.locale,{month:"short"})),i.push(t(e.getFullYear(),l,e.getDate()));else{s=e?e.getFullYear():a._dateInView[0].getFullYear(),o=s%10,0!==o&&(s-=o),s-=1;for(var d=0;d<12;d++)n.push(s+""),i.push(new Date(s,e.getMonth(),e.getDate())),++s}return{viewContent:n,dates:i}}},{key:"_setDisplayModeListContent",value:function(e){function t(e,t,a){var n=new Date(e,t+1,0),i=n.getDate();return a>i?n.setDate(i):n.setDate(a),n}var a=this,n=[];if(a.$dateViewContainer.addClass("smart-visibility-hidden"),a.$listViewContainer.hasClass("smart-hidden")&&(a.$content.addClass("smart-calendar-list-view"),a.$listViewContainer.removeClass("smart-hidden"),a.$.listViewContainer._setFocusable(),a.$.content.removeAttribute("tabindex")),a.$header.addClass("smart-hidden"),"year"===a.displayMode){for(var i=new Date,s=0;s<12;s++)i=t(i.getFullYear(),s,i.getDate()),n.push({label:i.toLocaleDateString(a.locale,{month:"short"}),value:t(e.getFullYear(),s,e.getDate()).toDateString()});a.$yearContainer.removeClass("smart-selected"),a.$dateContainer.addClass("smart-selected")}else{for(var o=a.min.getFullYear(),r=a.max.getFullYear(),l=o;l<=r;l++)n.push({label:l.toString(),value:new Date(l,e.getMonth(),e.getDate()).toDateString()});a.$yearContainer.addClass("smart-selected"),a.$dateContainer.removeClass("smart-selected")}a.$.listViewContainer.dataSource=n,a.$.listViewContainer.selectedValues=[e.toDateString()],a.$.listViewContainer.ensureVisible(a.$.listViewContainer.selectedValues[0]),a._setHeader(),a._updateHeaderElements()}},{key:"_isDateInView",value:function(e){var t=this;if(e)for(var a=0;a<t._dateInView.length;a++)if(e.getFullYear()===t._dateInView[a].getFullYear()&&e.getMonth()===t._dateInView[a].getMonth()){var n=t._getDayInstanceByValue(e,t._animationStarted?t.$.nextMonthsContainer:t.$.monthsContainer);if(!n)return;return!n.classList.contains("smart-other-month-date")&&!n.classList.contains("smart-visibility-hidden")}}},{key:"_keyDownHandler",value:function(e){var t=this;if(!t.disabled&&!t.readonly)switch(document.activeElement){case t.$.yearElement:"Escape"===e.key&&t._updateHeaderElements();break;case t.$.dateElement:if("default"===t.calendarMode&&" "===e.key||"Enter"===e.key)return void t._showDateView();t._focusedDate||t._focusDate(),t._navigateDays(e);break;case t.$.content:t._navigateDays(e);break;case t.$.yearContainer:if(" "!==e.key&&"Enter"!==e.key||"decade"===t.displayMode||t._showDateView("year"),e.key.indexOf("Arrow")>-1){if(t._focusedDate||t._focusDate(),"month"!==t.displayMode&&"list"===t.displayModeView)return t.focus(),void t.$.listViewContainer._handleKeyStrokes(e.key);t._navigateDays(e)}break;case t.$.dateContainer:if(" "!==e.key&&"Enter"!==e.key||"month"===t.displayMode||t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedDate,"month"),e.key.indexOf("Arrow")>-1){if(t._focusedDate||t._focusDate(),"month"!==t.displayMode&&"list"===t.displayModeView)return t.focus(),void t.$.listViewContainer._handleKeyStrokes(e.key);t._navigateDays(e)}break;default:if("month"!==t.displayMode&&"list"===t.displayModeView)return" "===e.key||"Enter"===e.key||e.ctrlKey&&("ArrowUp"===e.key||"ArrowDown"===e.key)?void t._navigateDays(e):void t.$.listViewContainer._handleKeyStrokes(e.key);e.key.indexOf("Arrow")>-1&&(t._focusedDate||t._focusDate(),t._navigateDays(e))}}},{key:"_listViewContainerChangeEventHandler",value:function(e){e.stopPropagation()}},{key:"_listViewContainerKeyDownHandler",value:function(e){var t=this;"list"===t.displayModeView&&(" "!==e.key&&"Enter"!==e.key||t._navigateDays(e))}},{key:"_showDateView",value:function(e){var t=this;switch(e=e||t.displayMode){case"month":e="year";break;case"year":e="decade"}if(t.displayMode!==e){if(!t.$.fireEvent("displayModeChanging",{oldDisplayMode:t.displayMode,newDisplayMode:e}).defaultPrevented){t.displayMode=e;var a=void 0;if(arguments[0]&&"list"===t.displayModeView&&"month"!==t.displayMode&&t.$.listViewContainer.items.length>0?(a=t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]),a.offsetHeight?t.$.animationPanel.style.transformOrigin=a.offsetLeft+a.offsetWidth/2+"px "+(a.dataItem.top>0?a.offsetTop-a.offsetHeight/2:a.offsetTop+a.offsetHeight/2)+"px":t.$.animationPanel.style.transformOrigin=t.$.listViewContainer.offsetLeft+t.$.listViewContainer.offsetWidth/2+"px "+(a.dataItem.top>0?a.offsetTop-a.offsetHeight/2:t.$.listViewContainer.offsetTop+t.$.listViewContainer.offsetHeight/2)+"px"):(t._focusedDate||t._focusDate(),a=t._focusedDate,t.$.animationPanel.style.transformOrigin=a.offsetLeft+a.offsetWidth/2+"px "+(a.offsetTop+a.offsetHeight/2)+"px"),t.$monthsContainer.addClass("smart-hidden"),t.$dateViewContainer.hasClass("smart-hidden")&&t.$dateViewContainer.removeClass("smart-hidden"),"decade"===t.displayMode&&(t.$yearContainer.addClass("smart-selected"),t.$dateContainer.removeClass("smart-selected")),t.$.hasClass("animation"))return void t._animateView(-1,a);t._setDisplayModeContent(t._focusedDate?t._focusedDate.value:t._dateInView[0])}}}},{key:"_keyUpHandler",value:function(e){var t=this;t.disabled||t.readonly||"default"!==t.selectionMode||"Shift"!==e.key&&"Control"!==e.key||(t._keysPressed[e.key]=!1)}},{key:"_mouseEventsHandler",value:function(e){var t=this;if(!t.disabled&&!t.readonly){if("mouseenter"===e.type)return void t.$.addClass("hovered");if("mouseleave"===e.type)return t.$.removeClass("hovered"),void(t.tooltip&&t.$.tooltip.close());if(!e.target.closest(".smart-calendar-week"))return void(t.tooltip&&t.$.tooltip.close());for(var a=e.target,n=void 0;a&&!(a.value instanceof Date);)a=a.parentElement,n=!0;if(a&&(Smart.Utilities.Core.isMobile||t._handleItemHoveredState(e,a),t.tooltip)){if(a.hasAttribute("important")&&"mouseover"===e.type)return t.$.tooltip.open(),t.tooltipTemplate?t.$.tooltip.value=a.value+"":t.$.tooltip.innerHTML=0===t.$.tooltip.innerHTML.trim().length?"Important day!":t.$.tooltip.innerHTML,t.$.tooltip.selector=a,void(t.$.tooltip.selector!==a&&t.$.tooltip.close());if(n||t.$.tooltip.selector===a)return;t.$.tooltip.close()}}}},{key:"_moveHandler",value:function(e){var t=this;if(Smart.Utilities.Core.isMobile&&t._dragStartDetails&&("list"!==t.displayModeView||"month"===t.displayMode)){e.originalEvent.preventDefault(),e.preventDefault(),e.stopPropagation();var a={x:Math.round(e.pageX),y:Math.round(e.pageY)},n=void 0;n="portrait"===t.scrollButtonsNavigationMode?a.y>t._dragStartDetails.y?-1*t.months:1*t.months:a.x<t._dragStartDetails.x?1*t.months:-1*t.months;var i=t._getNextDate(n);if(i&&(t._dragStartDetails.step=n,t._dragStartDetails.navigationDate=new Date(i),t.$.hasClass("animation"))){var s=void 0;if("month"!==t.displayMode)t.$nextMonthsContainer.addClass("smart-date-view-container"),s=t.$.dateViewContainer,t.$.nextMonthsContainer.children[0].value instanceof Date&&t.$.nextMonthsContainer.children[1].value.getFullYear()===i.getFullYear()||t._setDisplayModeContent(i,t.$.nextMonthsContainer);else if(t.$nextMonthsContainer.hasClass("smart-date-view-container")&&t.$nextMonthsContainer.removeClass("smart-date-view-container"),s=t.$.monthsContainer,!t.$.nextMonthsContainer.children[0]._date||t.$.nextMonthsContainer.children[0]._date.getTime()!==i.getTime())for(var o=t.$.nextMonthsContainer.children,r=0;r<o.length;r++)i.setMonth(t._dragStartDetails.navigationDate.getMonth()+r),t._setMonth(i,o[r],!0);n<0?(s.style.order=3,t.$.nextMonthsContainer.style.order=1,t.$.content[t._animationSettings.scrollSize]=t.$.content[t._animationSettings.scrollMax]):(s.style.order=1,t.$.nextMonthsContainer.style.order=3,t.$.content[t._animationSettings.scrollSize]=0);var l="portrait"===t.scrollButtonsNavigationMode?"y":"x";Math.abs(t._dragStartDetails[l]-a[l])>10&&(t.$.content[t._animationSettings.scrollSize]+=2*-(a[l]-t._dragStartDetails[l]))}}}},{key:"_getNextDate",value:function(e){var t=this,a=void 0;if("month"!==t.displayMode){var n=void 0;if("list"===t.displayModeView)a=new Date(t.$.listViewContainer.items[0].value);else{var i=t._animationStarted?t.$.nextMonthsContainer:t.$.dateViewContainer;a=new Date("year"===t.displayMode?i.children[0].value:i.children[1].value)}if(n="year"===t.displayMode?1:e>0?10:1,a.setFullYear(a.getFullYear()+(e>0?n:-n)),"year"===t.displayMode){if(a.getFullYear()<t.min.getFullYear()||a.getFullYear()>t.max.getFullYear())return}else if(a.getFullYear()<t.min.getFullYear()||a.getFullYear()>t.max.getFullYear())return}else{var s=t._dateInView[0];if(a=new Date(s),a.setDate(1),a.setMonth(a.getMonth()+e),a.setTime(Math.min(Math.max(a.getTime(),t.min.getTime()),t.max.getTime())),s.getMonth()===a.getMonth()&&s.getFullYear()===a.getFullYear())return}return a}},{key:"_navigateDays",value:function(e){var t=this,a="ArrowUp"===e.key||"ArrowDown"===e.key?7:1,n="ArrowUp"===e.key||"ArrowLeft"===e.key||"PageUp"===e.key?-1:1;switch(e.key){case"ArrowUp":case"ArrowLeft":case"ArrowDown":case"ArrowRight":if(!t._handleArrowKeys(e,a,n))return;break;case" ":case"Enter":if("month"!==t.displayMode)return void t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedDate);break;case"Control":case"Shift":return void("default"===t.selectionMode&&(t._keysPressed[e.key]=!0));case"Home":case"End":e.preventDefault();var i=void 0,s=function(t){if("Home"===e.key){for(var a=0;a<t.length;a++)if(!(0!==t[a].classList.length||t[a].disabled&&t[a].restricted))return t[a]}else for(var n=t.length-1;n>=0;n--)if(!(0!==t[n].classList.length||t[n].disabled&&t[n].restricted))return t[n]};if(!(i=s("month"!==t.displayMode?t.$.dateViewContainer.children:t._getMonthDays(t._focusedDate.closest(".smart-calendar-month"),t.rightToLeft).days)))return;t._focusDate(i);break;case"PageUp":case"PageDown":if(!t._handlePageUpDownKeys(e,n))return;break;default:return}t._focusedDate&&t._handleDateSelection(t._focusedDate)}},{key:"_handleArrowKeys",value:function(e,t,a){var n=this,i=void 0;if("month"!==n.displayMode||n._animationStarted||n.$.content.focus(),!e.altKey)if(e.ctrlKey){if("ArrowDown"===e.key||"ArrowUp"===e.key){var s=void 0;switch(n.displayMode){case"month":s="ArrowDown"===e.key?"month":"year";break;case"year":s="ArrowDown"===e.key?"month":"decade";break;case"decade":s="ArrowDown"===e.key?"year":"decade"}if(s!==n.displayMode){var o=n.displayMode;n.displayMode=s,n._setDisplayMode(o,s,"month"===o),n._keysPressed&&delete n._keysPressed.Control}}}else{if(e.preventDefault(),!n.rightToLeft||"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(a*=-1),"month"!==n.displayMode){var r=n._animationStarted?n.$.nextMonthsContainer.children:n.$.dateViewContainer.children;if(t="ArrowUp"===e.key||"ArrowDown"===e.key?4:1,"year"===n.displayMode){var l=n._focusedDate.value.getMonth()+a*t,d=new Date(n._focusedDate.value.getFullYear(),l+1,0);n._focusedDate.value.getDate()<=d.getDate()&&(d=n._focusedDate.value),i=new Date(n._focusedDate.value.getFullYear(),l,d.getDate())}else i=new Date(n._focusedDate.value.getFullYear()+a*t,n._focusedDate.value.getMonth(),n._focusedDate.value.getDate());if("year"===n.displayMode){if(i.getFullYear()<n.min.getFullYear()||i.getFullYear()===n.min.getFullYear()&&i.getMonth()<n.min.getMonth()||i.getFullYear()>n.max.getFullYear()||i.getFullYear()===n.max.getFullYear()&&i.getMonth()>n.max.getMonth())return;i.getTime()>r[r.length-1].value.getTime()?n.navigate(1):i.getTime()<r[0].value.getTime()&&n.navigate(-1)}else{if(i.getFullYear()<n.min.getFullYear()||i.getFullYear()>n.max.getFullYear())return;if(i.getFullYear()<r[1].value.getFullYear()||i.getFullYear()>r[10].value.getFullYear()){var m=n._focusedDate;n.navigate(a),"ArrowUp"!==e.key&&"ArrowDown"!==e.key||(m===r[3]||m===r[4]||m===r[7]||m===r[8]?i.setFullYear(i.getFullYear()+2*a):i.setFullYear(i.getFullYear()-2*a))}}return void n._focusDate(n._getDayInstanceByValue(i,n._animationStarted?n.$.nextMonthsContainer:void 0))}var c=n.restrictedDates.map(Number);for(i=new Date(n._focusedDate.value.getFullYear(),n._focusedDate.value.getMonth(),n._focusedDate.value.getDate()+a*t,0,0,0,0);c.indexOf(i.getTime())>-1;)i.setDate(i.getDate()+a);if(!(i.getTime()<n.min.getTime()||i.getTime()>n.max.getTime())){n._isDateInView(i)||n.navigate(a*n.months);var u=n._getDayInstanceByValue(i,n._animationStarted?n.$.nextMonthsContainer:void 0);if(n._focusDate(u),!(["zeroOrMany","oneOrMany","none","many","week"].indexOf(n.selectionMode)>-1))return!0}}}},{key:"_handlePageUpDownKeys",value:function(e,t){var a=this;e.preventDefault();var n=void 0;if("month"!==a.displayMode){if(n=a._focusedDate,!a.navigate(t))return;for(;n&&n.classList.contains("smart-visibility-hidden");)n=null===n.previousElementSibling?n.nextElementSibling:n.previousElementSibling;return a._focusDate(n),void(a.$.hasClass("animation")&&"decade"===a.displayMode&&a._focusedDate.value.setFullYear(a._focusedDate.value.getFullYear()+10*t))}n=new Date(a._focusedDate.value.getFullYear(),a._focusedDate.value.getMonth()+t,1,0,0,0,0);var i=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();return a._focusedDate.value.getDate()>i?n.setDate(i):n.setDate(a._focusedDate.value.getDate()),a._isDateInView(n)||a.navigate(t*a.months),a._animationStarted?a._focusDate(a._getDayInstanceByValue(n,a.$.nextMonthsContainer)):a._focusDate(a._getDayInstanceByValue(n)),!0}},{key:"_selectDate",value:function(e,t,a){var n=this;if(void 0!==n._dateInView&&"none"!==n.selectionMode){var i=n.selectedDates.slice(0);if(e instanceof HTMLElement&&e.parentElement.classList.contains("smart-calendar-week"))e=n._selectDay(e);else{if(!(e instanceof Date))return;var s=n._getDayInstanceByValue(e,n._animationStarted?n.$.nextMonthsContainer:n.$.monthsContainer);s&&n._selectDay(s)}var o=void 0;e=new Date(e),e.setHours(0,0,0,0),o=i.map(Number).indexOf(e.getTime()),n.restrictedDates.map(Number).indexOf(e.getTime())>-1||e.getTime()<n.min.getTime()||e.getTime()>n.max.getTime()||(o>-1?i.splice(o,1):i.push(e),a||(n.selectedDates=i),t||(n._setFooter(),n.$.hiddenInput.value=n.selectedDates.toString(),n.$.fireEvent("change",{value:[e]})),n._setTitle())}}},{key:"_selectDay",value:function(e){var t=this,a=e;if(!(!a||t.restrictedDates.map(Number).indexOf(a.value.getTime())>-1||t.disableAutoNavigation&&a.classList.length>0||a.value.getTime()<t.min.getTime()||a.value.getTime()>t.max.getTime())){var n=t._selectedDates.indexOf(a);return n>-1?(a.selected=!1,a.removeAttribute("selected"),t._selectedDates.splice(n,1)):(a.selected=!0,a.setAttribute("selected",""),t._selectedDates.push(a)),t._focusDate(a),a.value}}},{key:"_setDayNames",value:function(){for(var e=this,t=[],a=new Date,n=void 0,i=1;i<8;i++)a.setDate(i),n={number:a.getDay(),name:function(t){return"firstTwoLetters"===e.dayNameFormat?new Intl.DateTimeFormat(e.locale,{weekday:"long"}).format(t).substr(0,2):new Intl.DateTimeFormat(e.locale,{weekday:e.dayNameFormat}).format(t)}(a)},t.push(n);t.sort(function(e,t){return e.number>t.number});for(var s=e.$.monthsContainer.children,o=void 0,r=void 0,l=0;l<s.length;l++)if(o=s[l].getElementsByClassName("smart-calendar-week-titles")[0].children,r=e.firstDayOfWeek>6?0:e.firstDayOfWeek,e.rightToLeft)for(var d=o.length-1;d>=0;d--)o[d].textContent=t[r++].name,r=r>6?0:r;else for(var m=1;m<o.length;m++)o[m].textContent=t[r++].name,r=r>6?0:r}},{key:"_setCalendarMode",value:function(){var e=this;if(!e.headerTemplate)if(e._setMonthNames(),"default"===e.calendarMode){e.$classicHeaderDate.addClass("smart-hidden"),e.$defaultHeaderDate.removeClass("smart-hidden");var t=e._dateInView.slice(0).sort(function(e,t){return e.getTime()-t.getTime()}),a=t[0].toLocaleDateString(e.locale,{year:e.yearFormat,month:e.monthNameFormat});e.months>1&&(a+=" - "+t[t.length-1].toLocaleDateString(e.locale,{year:e.yearFormat,month:e.monthNameFormat})),e.$.defaultHeaderDate.innerHTML=a,e.unfocusable||e.$.dateElement.setAttribute("tabindex",e.tabIndex>0?e.tabIndex:0)}else e.$defaultHeaderDate.addClass("smart-hidden"),e.$classicHeaderDate.removeClass("smart-hidden"),e.$.dateElement.removeAttribute("tabindex")}},{key:"_setFooter",value:function(){function e(){if(0===t.selectedDates.length)return"";if(1===t.selectedDates.length)return t.selectedDates[0].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"});var e=t.selectedDates.slice(0).sort(function(e,t){return e.getTime()-t.getTime()});return e[0].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"})+" - "+e[e.length-1].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"})}var t=this;if(!("many"!==t.selectionMode||t.viewSections.indexOf("footer")<0||0===t.$.footer.offsetHeight))if(t.footerTemplate){var a=t._layoutTemplates.filter(function(e){return e.selector===t.$.footer})[0],n=document.importNode(a.template.content,!0);if(a.bindings.length>0){var i=n.childNodes[a.bindings[0].childNodeIndex];a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=i.innerHTML.replace(a.bindings[0].bindingString,e())}}else t.$.selectedDatesRange.innerHTML=e()}},{key:"_setImportantDates",value:function(e){function t(e){if(!a._importantDatesTemplate)return void(e.innerHTML=e.value.getDate()+"");var t=document.importNode(a._importantDatesTemplate.content,!0);if(a._bindingDetails&&a._bindingDetails.length>0){var n=t.childNodes[a._bindingDetails[0].childNodeIndex];n.innerHTML=n.innerHTML.replace(a._bindingDetails[0].bindingString,e.value.getDate())}e.innerHTML="";for(var i=0;i<t.childNodes.length;i++)t.childNodes[i].outerHTML&&(e.innerHTML+=t.childNodes[i].outerHTML)}var a=this,n=void 0;if("month"===a.displayMode){if(!e){n=a.$.monthsContainer.children;for(var i=0;i<n.length;i++)a._getMonthDays(n[i]).days.map(function(e){e.important=!1,e.removeAttribute("important")})}if(e&&e.value instanceof Date)return e.important=!0,e.setAttribute("important",""),void t(e);if((e=a.importantDates)instanceof Array)for(var s=e.length,o=void 0,r=0;r<s;r++)(o=a._getDayInstanceByValue(e[r]))&&(o.important=!0,o.setAttribute("important",""),t(o))}}},{key:"_setMonth",value:function(e,t,a){var n=this,i=n._getDays(e,n.selectedDates),s=n._getDays(e,n.importantDates),o=n._getDays(e,n.restrictedDates);e.setDate(1),t||(t=n.$.month),t._date=new Date(e),a||((!n._dateInView||n._dateInView.length>=n.months)&&(n._dateInView=[]),n._dateInView.push(new Date(e))),e=new Date(e);var r=(e.getDay()-n.firstDayOfWeek+7)%7;e.setDate(0);var l=e.getDate();if(e.setDate(32),e.setDate(1),e.setDate(32),n._selectedDates)for(var d=0;d<n._selectedDates.length;d++)n._selectedDates[d].closest(".smart-calendar-month")===t&&(n._selectedDates[d].selected=!1,n._selectedDates[d].removeAttribute("selected"));n._setMonthContent(e,t,{previusMonthDays:l,firstDayOfWeek:r,selectedDates:i,importantDates:s,restrictedDates:o})}},{key:"_setMonthContent",value:function(e,t,a){var n=this,i=32-e.getDate(),s=n._getMonthDays(t,n.rightToLeft),o=t._date.getMonth(),r=t._date.getFullYear(),l=new Date,d=1,m=1,c=s.days,u=void 0;l.setHours(0,0,0,0),c.map(function(e){e.disabled=e.restricted=e.selected=e.focused=e.important=e.today=!1,e.removeAttribute("restricted"),e.removeAttribute("selected"),e.removeAttribute("focused"),e.removeAttribute("important"),e.removeAttribute("today")});for(var h=0;h<c.length;h++)c[h].classList.remove("hover"),h===a.firstDayOfWeek&&m<=i?(c[h].hasAttribute("class")&&c[h].removeAttribute("class"),c[h].value=new Date(r,o,m),c[h].innerHTML=c[h].value.getDate().toString(),a.restrictedDates.indexOf(m)>-1||c[h].value.getTime()<n.min.getTime()||c[h].value.getTime()>n.max.getTime()?(c[h].restricted=!0,c[h].setAttribute("restricted","")):a.selectedDates.indexOf(m)>-1&&(c[h].selected=!0,c[h].setAttribute("selected",""),n._selectedDates.indexOf(c[h])<0&&n._selectedDates.push(c[h])),a.importantDates.indexOf(m)>-1&&(n._setImportantDates(c[h]),a.importantDates.splice(a.importantDates.indexOf(m),1)),c[h].value.getTime()===l.getTime()&&(c[h].today=!0,c[h].setAttribute("today","")),a.firstDayOfWeek++,m++):(1===m?(c[h].value=new Date(r,o-1,++a.previusMonthDays-a.firstDayOfWeek),u=!!(c[h].value.getTime()<n.min.getTime()||t.previousElementSibling)):(c[h].value=new Date(r,o+1,d++),u=!!(c[h].value.getTime()>n.max.getTime()||t.nextElementSibling)),c[h].innerHTML=c[h].value.getDate().toString(),u?c[h].classList.add("smart-visibility-hidden"):(c[h].classList.add("smart-other-month-date"),c[h].classList.remove("smart-visibility-hidden")));n.months>1&&(t.firstElementChild.innerHTML=n.dateFormatFunction?n.dateFormatFunction(t._date):n._monthsNames[o]+" "+t._date.toLocaleDateString(n.locale,{year:n.yearFormat})),n._setMonthWeekNumbers(t,s.weeks)}},{key:"_setMonthNames",value:function(){var e=this,t=new Date,a=void 0;t.setDate(1),e._monthsNames=[];for(var n=0;n<12;n++)t.setMonth(n),a=function(t){var a=new Intl.DateTimeFormat(e.locale,{month:e.monthNameFormat}).format(t);return"firstTwoLetters"===e.monthNameFormat&&(a=a.substr(0,2)),a}(t),e._monthsNames.push(a);if("classic"===e.calendarMode&&e.$.monthElement){
var i=e.$.monthsContainer.children;if(e.$.monthElement.dataSource&&(e._changeEventFired=1),e.$.monthElement.dataSource=e._monthsNames,e._dateInView){for(var s=0;s<i.length;s++)i[s].firstElementChild.textContent=e._monthsNames[i[s]._date.getMonth()]+" "+i[s]._date.getFullYear();e._changeEventFired=1,e.$.monthElement.selectedIndexes=e._dateInView.map(function(e){return e.getMonth()})}}}},{key:"_setMonthWeekNumbers",value:function(e,t){for(var a=this,n=void 0,i=void 0,s=0;s<t.length;s++)!function(e){for(var t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!0}(t[s])?t[s].children[0].innerHTML="":(n=t[s].children[1],i=n.classList.contains("smart-other-month-date")?n.value.getTime()>e._date.getTime()?1:-1:0,t[s].children[0].innerHTML=a._getWeekNumber(new Date(e._date.getFullYear(),e._date.getMonth()+i,n.value.getDate())))}},{key:"_setRestrictedDates",value:function(e){for(var t=this,a=e.length,n=t.$.monthsContainer.children,i=0;i<n.length;i++)t._getMonthDays(n[i]).days.map(function(e){e.restricted=!1,e.removeAttribute("restricted")});if(t._dateInView)for(var s=void 0,o=0;o<a;o++)(function(e){for(var a=0;a<t._dateInView.length;a++)if(t._dateInView[a].getFullYear()===e.getFullYear()&&t._dateInView[a].getMonth()===e.getMonth())return!0})(e[o])&&(s=t._getDayInstanceByValue(e[o]),s.restricted=!0,s.setAttribute("restricted",""))}},{key:"_setScrollButtonsNavigationMode",value:function(){var e=this;"landscape"===e.scrollButtonsNavigationMode?(e.$.previousMonthButton&&(e.$.previousMonthButton.$.button.firstElementChild.innerHTML="&#xe809"),e.$.nextMonthButton&&(e.$.nextMonthButton.$.button.firstElementChild.innerHTML="&#xe810")):(e.$.previousMonthButton&&(e.$.previousMonthButton.$.button.firstElementChild.innerHTML="&#xe80b"),e.$.nextMonthButton&&(e.$.nextMonthButton.$.button.firstElementChild.innerHTML="&#xe80d")),e._applyAnimationSettings(!0)}},{key:"_setTitle",value:function(){var e=this;if(0!==e.$.title.offsetHeight){var t=e.selectedDates.length>0?e.selectedDates[e.selectedDates.length-1]:new Date;if(e.titleTemplate){var a=e._layoutTemplates.filter(function(t){return t.selector===e.$.title})[0],n=document.importNode(a.template.content,!0);if(a.bindings.length>0){var i=n.childNodes[a.bindings[0].childNodeIndex];return t=t.toLocaleDateString(e.locale,{year:e.yearFormat,weekday:"short",month:"short",day:"numeric"}),void(a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=i.innerHTML.replace(a.bindings[0].bindingString,t))}}e.$.title.children[0].innerHTML=t.toLocaleDateString(e.locale,{year:e.yearFormat}),e.$.title.children[1].innerHTML="landscape"===e.view?t.toLocaleDateString(e.locale,{weekday:"short"})+",</br>"+t.toLocaleDateString(e.locale,{month:"short",day:"numeric"}):t.toLocaleDateString(e.locale,{weekday:"short"})+", "+t.toLocaleDateString(e.locale,{month:"short",day:"numeric"})}}},{key:"_setWeeksVisibility",value:function(e){function t(e){if(function(e){for(var t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!1;return!0}(e)||i>=a.weeks)return void e.classList.add("smart-hidden");i<a.weeks&&(e.classList.remove("smart-hidden"),i++)}for(var a=this,n=e.children,i=void 0,s=0;s<n.length;s++){(function(e){var s=a._getMonthDays(n[e]).weeks,o=a._selectedDates.filter(function(t){return t.closest(".smart-calendar-month")===n[e]});if(6===a.weeks)return s.map(function(e){return e.classList.remove("smart-hidden")}),"continue";if(i=0,o.length>0){for(var r=o[o.length-1],l=s.indexOf(r.parentElement),d=l;d<s.length;d++)t(s[d]);for(var m=l-1;m>=0;m--)t(s[m])}else for(var c=0;c<s.length;c++)t(s[c])})(s)}}},{key:"_updateHeaderElements",value:function(){var e=this,t=e._animationStarted?e.$.nextMonthsContainer:e.$.dateViewContainer,a=e._dateInView[e._dateInView.length-1],n=e._dateInView.map(function(e){return e.getFullYear()}),i=void 0,s=void 0;if("month"===e.displayMode||"list"!==e.displayModeView){if(e.$.previousMonthButton&&!e.disabled&&("month"!==e.displayMode&&e.$.dateViewContainer.children[0].value?s="year"===e.displayMode?t.children[0].value.getFullYear()-1:t.children[1].value.getFullYear()-1:e._dateInView[0].getMonth()-1<0?(i=11,s=e._dateInView[0].getFullYear()-1):(i=e._dateInView[0].getMonth()-1,s=e._dateInView[0].getFullYear()),e.$.previousMonthButton.disabled=s<e.min.getFullYear()||s===e.min.getFullYear()&&i<e.min.getMonth(),e.$.previousMonthButton.disabled&&e.$.content.focus()),e.$.nextMonthButton&&!e.disabled&&("month"!==e.displayMode&&e.$.dateViewContainer.children[0].value?s="year"===e.displayMode?t.children[0].value.getFullYear()+1:t.children[1].value.getFullYear()+11:a.getMonth()+1>11?(i=0,s=a.getFullYear()+1):(i=a.getMonth()+1,s=a.getFullYear()),e.$.nextMonthButton.disabled=s>e.max.getFullYear()||s===e.max.getFullYear()&&i>e.max.getMonth(),e.$.nextMonthButton.disabled&&e.$.content.focus()),"classic"===e.calendarMode&&e.$.monthElement){var o=e.$.monthElement.items;if(o.map(function(e){return e.disabled=!1}),n.indexOf(e.min.getFullYear())>-1)for(var r=0;r<e.min.getMonth();r++)o[r].disabled=!0;if(n.indexOf(e.max.getFullYear())>-1)for(var l=e.max.getMonth()+1;l<o.length;l++)o[l].disabled=!0;e._changeEventFired=e.$.monthElement.selectedIndexes.length,e.$.monthElement.selectedIndexes=[e._dateInView[0].getMonth()],e._changeEventFired=0}e.$.decrementYearButton&&!e.disabled&&(s=e._dateInView[0].getFullYear()-1,e.$.decrementYearButton.disabled=s<e.min.getFullYear(),e.$.decrementYearButton.disabled&&e.$.content.focus()),e.$.incrementYearButton&&!e.disabled&&(s=a.getFullYear()+1,e.$.incrementYearButton.disabled=s>e.max.getFullYear(),e.$.incrementYearButton.disabled&&e.$.content.focus()),e.$.yearElement&&(e.$.yearElement.value=n[0],e.$.yearElement.disabled=a.getFullYear()+1>e.max.getFullYear()&&e._dateInView[0].getFullYear()-1<e.min.getFullYear())}}},{key:"_setHeader",value:function(){function e(){if("month"!==t.displayMode){if("list"===t.displayModeView&&t.$.listViewContainer.selectedValues[0])a="year"===t.displayMode?new Date(t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]).value).getFullYear():t.min.getFullYear()+" - "+t.max.getFullYear();else if(t.$.dateViewContainer.children[0].value){var e=t._animationStarted?t.$.nextMonthsContainer.children:t.$.dateViewContainer.children;a="year"===t.displayMode?e[0].value.getFullYear():e[1].value.getFullYear()+" - "+e[e.length-2].value.getFullYear()}if(a)return a}var n=t._dateInView.slice(0).sort(function(e,t){return e.getTime()-t.getTime()});return a=n[0].toLocaleDateString(t.locale,{year:t.yearFormat,month:t.monthNameFormat}),t.months>1&&(a+=" - "+n[n.length-1].toLocaleDateString(t.locale,{year:t.yearFormat,month:t.monthNameFormat})),a}var t=this,a=void 0;if("default"===t.calendarMode&&(t.$.defaultHeaderDate.innerHTML=e()),t._layoutTemplates){var n=t._layoutTemplates.filter(function(e){return e.selector===t.$.header})[0];if(n){var i=document.importNode(n.template.content,!0);if(n.bindings.length>0){var s=i.childNodes[n.bindings[0].childNodeIndex];n.selector.childNodes[n.bindings[0].childNodeIndex].innerHTML=s.innerHTML.replace(n.bindings[0].bindingString,t.dateFormatFunction?t.dateFormatFunction(t._dateInView):e())}}}}},{key:"_updateWeeksVisibility",value:function(e){var t=this,a=e.parentElement;if(a.classList.contains("smart-hidden")){var n=[].slice.call(a.parentElement.children),i=n.indexOf(a),s=0;n.map(function(e){return e.classList.add("smart-hidden")});for(var o=i;o<n.length;o++)if(!function(e){for(var t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!1;return!0}(n[o])&&(n[o].classList.remove("smart-hidden"),++s===t.weeks))return;if(s<t.weeks)for(var r=i-1;r>=0;--r)if(n[r].classList.remove("smart-hidden"),++s===t.weeks)return}}},{key:"_validateDate",value:function(e){function t(e){if(e instanceof Date)return e;if(Smart.Utilities.DateTime&&e instanceof Smart.Utilities.DateTime)return e.toDate();if("string"==typeof e){if("new Date()"===e.trim()||"new Smart.Utilities.DateTime()"===e.trim())return new Date;if(isNaN(Date.parse(e))){var t=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;t.test(e)&&(e=t.exec(e)[0].replace(/[,-.\/]/g,",").split(","))&&(e=new Date(parseInt(e[0]),parseInt(e[1]),parseInt(e[2])))}return new Date(Date.parse(e))}}var a=[];if(void 0!==e){if(e instanceof Array)for(var n=0;n<e.length;n++)a.push(t(e[n]));else a.push(t(e));return a=a.filter(function(e){return e&&"Invalid Date"!==e.toDateString()}),a.map(function(e){return e.setHours(0,0,0,0)}),a}}},{key:"_validateSelectedDates",value:function(e){var t=this,a=[];e||(e=t.selectedDates);var n=e.slice(0),i=function(e){if(e.getTime()>=t.min.getTime()&&e.getTime()<=t.max.getTime()&&!s(e))return!0;a.push(e)},s=function(e){for(var a=0;a<t.restrictedDates.length;a++)if(t.restrictedDates[a].getTime()===e.getTime())return!0};t.selectedDates=n.filter(i),t._dateInView&&(a.map(function(e){return t._selectDate(e)}),t._focusDate())}},{key:"_validateMinMax",value:function(e,t,a){var n=this;switch(e){case"min":t=n._validateDate(n[e])[0],n.min=t||(a||n.properties.min.defaultValue);break;case"max":t=n._validateDate(n[e])[0],n.max=t||(a||n.properties.max.defaultValue);break;default:t=n._validateDate(n.min)[0],n.min=t||(a||n.properties.min.defaultValue),t=n._validateDate(n.max)[0],n.max=t||(a||n.properties.max.defaultValue)}n.min=n.min.getTime()>n.max.getTime()?n.max:n.min,n.min.setHours(0,0,0,0),n.max.setHours(0,0,0,0);var i=n.$.monthsContainer.children,s=void 0;if(n._dateInView){if(n._dateInView[0].getTime()>n.max.getTime()||n._dateInView[0].getTime()<n.min.getTime())return void n._handleMonths();for(var o=0;o<i.length;o++){s=n._getMonthDays(i[o]).days;for(var r=0;r<s.length;r++)if(s[r].value.getTime()>=n.min.getTime()&&s[r].value.getTime()<=n.max.getTime())s[r].restricted=!1,s[r].removeAttribute("restricted"),s[r].value.getMonth()===i[o]._date.getMonth()?s[r].classList.remove("smart-visibility-hidden"):n.hideOtherMonthDays||(s[r].classList.add("smart-other-month-date"),s[r].classList.remove("smart-visibility-hidden")),"month"!==n.displayMode&&s[r].classList.remove("smart-other-month-date");else{if(0===s[r].classList.length)s[r].restricted=!0,s[r].setAttribute("restricted","");else if(s[r].classList.contains("smart-visibility-hidden")){s[r].restricted=!1,s[r].removeAttribute("restricted");continue}"month"!==n.displayMode&&(s[r].classList.remove("smart-visibility-hidden"),s[r].classList.add("smart-other-month-date"))}}}}},{key:"_validateTemplate",value:function(e,t){if(null!==t&&t){var a=this;return"content"in document.createElement("template")?(t instanceof HTMLTemplateElement||(t=document.getElementById(t)),null!==t&&"content"in t?t:void a.error(a.localize("invalidTemplate",{elementType:a.nodeName.toLowerCase(),property:e}))):void a.error(a.localize("htmlTemplateNotSuported",{elementType:a.nodeName.toLowerCase()}))}}},{key:"_weeksDownHandler",value:function(e){var t=this,a=e.value,n=void 0;if(e.classList.contains("smart-other-month-date")&&(n=e.value.getTime()>e.closest(".smart-calendar-month")._date.getTime()?1:-1),n){if(t._isDateInView(e.value))return;return void(t.disableAutoNavigation||t.navigate(n*t.months))}(e=t._getDayInstanceByValue(a))&&(e.disabled||e.restricted)||t._handleDateSelection(e)}},{key:"_firstDayOfWeekValidator",value:function(e,t){return Math.min(Math.max(0,isNaN(t)?6:t),6)}},{key:"_weeksValidator",value:function(e,t){return Math.min(Math.max(1,isNaN(t)?6:t),6)}},{key:"_monthsValidator",value:function(e,t){return Math.min(Math.max(1,isNaN(t)?1:t),12)}}],[{key:"properties",get:function(){return{animationSettings:{value:null,type:"object?"},calendarMode:{value:"default",allowedValues:["default","classic"],type:"string"},dayNameFormat:{value:"firstTwoLetters",allowedValues:["narrow","firstTwoLetters","long","short"],type:"string"},dateFormatFunction:{value:null,type:"function"},disableAutoNavigation:{value:!1,type:"boolean"},displayMode:{value:"month",allowedValues:["month","year","decade"],type:"string"},displayModeView:{value:"table",allowedValues:["table","list"],type:"string"},firstDayOfWeek:{value:0,type:"number",defaultValue:0,validator:"_firstDayOfWeekValidator"},footerTemplate:{value:null,type:"any?"},headerTemplate:{value:null,type:"any?"},hideDayNames:{value:!1,type:"boolean"},hideOtherMonthDays:{value:!1,type:"boolean"},hideTooltipArrow:{value:!1,type:"boolean"},importantDates:{value:[],type:"array",defaultValue:[]},importantDatesTemplate:{value:null,type:"string?"},max:{value:new Date(2100,1,1),type:"any",defaultValue:new Date(2100,1,1)},min:{value:new Date(1900,1,1),type:"any",defaultValue:new Date(1900,1,1)},months:{value:1,type:"number",defaultValue:1,validator:"_monthsValidator"},monthNameFormat:{value:"long",allowedValues:["narrow","firstTwoLetters","long","short","2-digit","numeric"],type:"string"},name:{value:"",type:"string"},restrictedDates:{value:[],type:"array",defaultValue:[]},scrollButtonsNavigationMode:{value:"landscape",allowedValues:["portrait","landscape"],type:"string"},scrollButtonsPosition:{value:"both",allowedValues:["near","far","both"],type:"string"},selectedDates:{value:[],type:"array"},selectionMode:{value:"default",allowedValues:["none","default","one","many","zeroOrMany","oneOrMany","zeroOrOne","week"],type:"string"},spinButtonsDelay:{value:80,type:"number"},spinButtonsInitialDelay:{value:0,type:"number"},titleTemplate:{value:null,type:"string?"},tooltip:{value:!1,type:"boolean"},tooltipDelay:{value:100,type:"number"},tooltipPosition:{value:"top",allowedValues:["bottom","top","left","right","absolute"],type:"string"},tooltipTemplate:{value:null,type:"string?"},view:{value:"portrait",allowedValues:["landscape","portrait"],type:"string"},viewSections:{value:["header"],type:"array"},weekNumbers:{value:!1,type:"boolean"},weeks:{value:6,type:"number",defaultValue:6,validator:"_weeksValidator"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"}}}},{key:"listeners",get:function(){return{"container.down":"_downHandler","document.up":"_documentUpHandler","container.move":"_moveHandler","container.wheel":"_containerWheelHandler","content.focus":"_contentStateHandler","content.blur":"_contentStateHandler","header.click":"_headerClickHandler","header.change":"_headerChangeHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler","listViewContainer.keydown":"_listViewContainerKeyDownHandler","listViewContainer.change":"_listViewContainerChangeEventHandler",mouseenter:"_mouseEventsHandler",mouseleave:"_mouseEventsHandler",mouseover:"_mouseEventsHandler",mouseout:"_mouseEventsHandler"}}},{key:"requires",get:function(){return{"Smart.Tooltip":"smart.tooltip.js"}}}]),t}(Smart.BaseElement));
//# sourceMappingURL=smart.calendar.js.map
